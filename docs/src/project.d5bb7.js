window.__require=function t(e,o,n){function i(a,c){if(!o[a]){if(!e[a]){var s=a.split("/");if(s=s[s.length-1],!e[s]){var p="function"==typeof __require&&__require;if(!c&&p)return p(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+a+"'")}}var d=o[a]={exports:{}};e[a][0].call(d.exports,function(t){return i(e[a][1][t]||t)},d,d.exports,t,e,o,n)}return o[a].exports}for(var r="function"==typeof __require&&__require,a=0;a<n.length;a++)i(n[a]);return i}({BaseBlock:[function(t,e,o){"use strict";cc._RF.push(e,"669c7JMb+JDKJWbhc7886gK","BaseBlock"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,i=n.ccclass,r=n.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.width=100,e}return __extends(e,t),__decorate([r(cc.Integer)],e.prototype,"width",void 0),e=__decorate([i],e)}(cc.Component);o.BaseBlock=a,cc._RF.pop()},{}],Block1:[function(t,e,o){"use strict";cc._RF.push(e,"9090fb+2iFAg5eqgo+4dk7V","Block1"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./BaseBlock"),i=t("../../../utils/MathHelper"),r=cc._decorator,a=r.ccclass,c=r.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.top=null,e.bottom=null,e.offsetScaleMin=-1,e.offsetScaleMax=1,e.bloodNodes=[],e.hintNode=null,e}return __extends(e,t),e.prototype.init=function(){var t=i.MathHelper.GetRandomIntegerInRange(10*this.offsetScaleMin,10*this.offsetScaleMax)/10;this.top.scaleY=1+t,this.bottom.scaleY=1-t},e.prototype.showBlood=function(){this.hintNode.active=!1},__decorate([c(cc.Node)],e.prototype,"top",void 0),__decorate([c(cc.Node)],e.prototype,"bottom",void 0),__decorate([c(cc.Float)],e.prototype,"offsetScaleMin",void 0),__decorate([c(cc.Float)],e.prototype,"offsetScaleMax",void 0),__decorate([c([cc.Node])],e.prototype,"bloodNodes",void 0),__decorate([c(cc.Node)],e.prototype,"hintNode",void 0),e=__decorate([a],e)}(n.BaseBlock);o.Block1=s,cc._RF.pop()},{"../../../utils/MathHelper":"MathHelper","./BaseBlock":"BaseBlock"}],G:[function(t,e,o){"use strict";cc._RF.push(e,"35b4bARC59Nsb6BDflVfP8d","G"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function e(){var e=t.call(this)||this;return e.initManagers(),e}return __extends(e,t),e.prototype.initManagers=function(){},e.Instance=new e,e}(cc.EventTarget);o.G=n.Instance,cc._RF.pop()},{}],LoadingScene:[function(t,e,o){"use strict";cc._RF.push(e,"c6f035Mue9D8LIsVN5UsroP","LoadingScene"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,i=n.ccclass,r=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.start=function(){this.node.on(cc.Node.EventType.TOUCH_END,this.onBtnStart,this)},e.prototype.onBtnStart=function(){cc.director.loadScene("main")},e=__decorate([i],e)}(cc.Component));o.LoadingScene=r,cc._RF.pop()},{}],MainScene:[function(t,e,o){"use strict";cc._RF.push(e,"3a427dRptJMj7ZJP8okpBNx","MainScene"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./Player"),i=t("./RoadManager"),r=t("./StartAnim"),a=t("./OverAnim"),c=cc._decorator,s=c.ccclass,p=c.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.player1=null,e.player2=null,e.roadManager=null,e.audioClip1=null,e.audioClip2=null,e.startAnim=null,e.overAnim=null,e}return __extends(e,t),e.prototype.onLoad=function(){cc.director.getCollisionManager().enabled=!0},e.prototype.start=function(){var t=this;this.addEventListeners(),this.roadManager.init(this),this.player1.init(this,this.roadManager.getHalfDistance()),this.player2.init(this,this.roadManager.getHalfDistance()),this.startAnim.play(function(){t.startGame()})},e.prototype.onDisable=function(){this.removeEventListeners()},e.prototype.startGame=function(){this.player1.run(),this.player2.run(),this.playFirstBgm()},e.prototype.player1Shot=function(){var t=this.player1.node.parent.convertToWorldSpaceAR(this.player1.node.position);this.roadManager.shot(t,this.player1.dir)},e.prototype.player2Shot=function(){var t=this.player2.node.parent.convertToWorldSpaceAR(this.player2.node.position);this.roadManager.shot(t,this.player2.dir)},e.prototype.speak=function(t,e){},e.prototype.playSecondBgm=function(){cc.audioEngine.play(this.audioClip2,!0,1)},e.prototype.playFirstBgm=function(){cc.audioEngine.play(this.audioClip1,!0,1)},e.prototype.overGame=function(t){this.player1.stop(),this.player2.stop(),this.playSecondBgm(),this.overAnim.play(t,function(){cc.log("over")})},e.prototype.onRoadInit=function(t,e){this.player1.node.parent.x=t+220,this.player2.node.parent.x=e-220},e.prototype.onKeyDown=function(t){switch(t.keyCode){case cc.macro.KEY.space:this.player1.jump();break;case cc.macro.KEY.a:this.player1Shot();break;case cc.macro.KEY.enter:this.player2.jump();break;case cc.macro.KEY.l:this.player2Shot()}},e.prototype.addEventListeners=function(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this)},e.prototype.removeEventListeners=function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this)},__decorate([p(n.Player)],e.prototype,"player1",void 0),__decorate([p(n.Player)],e.prototype,"player2",void 0),__decorate([p(i.RoadManager)],e.prototype,"roadManager",void 0),__decorate([p({type:cc.AudioClip})],e.prototype,"audioClip1",void 0),__decorate([p({type:cc.AudioClip})],e.prototype,"audioClip2",void 0),__decorate([p(r.StartAnim)],e.prototype,"startAnim",void 0),__decorate([p(a.OverAnim)],e.prototype,"overAnim",void 0),e=__decorate([s],e)}(cc.Component);o.MainScene=d,cc._RF.pop()},{"./OverAnim":"OverAnim","./Player":"Player","./RoadManager":"RoadManager","./StartAnim":"StartAnim"}],MathHelper:[function(t,e,o){"use strict";cc._RF.push(e,"a2a7fPDyUhOK6lkuKJAqJa7","MathHelper"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function t(){}return t.GetRandomIntegerInRange=function(t,e,o,n){void 0===o&&(o=!0),void 0===n&&(n=!0);var i=o?t:t+1,r=n?e+1:e;return i+Math.floor(Math.random()*(r-i))},t}();o.MathHelper=n,cc._RF.pop()},{}],NextFSM:[function(t,e,o){"use strict";cc._RF.push(e,"9e8872BA1JDE4kbRDZrVrSh","NextFSM"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function t(t,e,o){this.stateMap=t,this.initState=e,this.target=o,this._state=this.initState}return t.prototype.getState=function(){return this._state},t.prototype.getLastState=function(){return this._lastState},t.prototype.setState=function(t){return this.canTo(t)?(this._lastState=this._state,this._state=t,this.stateMap[this._lastState].exit&&this.stateMap[this._lastState].exit.apply(this.target),this.stateMap[this._state].enter&&this.stateMap[this._state].enter.apply(this.target),!0):(console.error("can not set state"),!1)},t.prototype.canTo=function(t){return this.stateMap[this._state].to.indexOf(t)>-1},t}();o.NextFSM=n,cc._RF.pop()},{}],OverAnim:[function(t,e,o){"use strict";cc._RF.push(e,"095730pKOxBaYMOorxF6m70","OverAnim"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,i=n.ccclass,r=n.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.topContainer=null,e.bottomContainer=null,e.win1=null,e.win2=null,e.lose1=null,e.lose2=null,e}return __extends(e,t),e.prototype.play=function(t,e){this.node.active=!0,t?(this.win2.active=!0,this.win1.active=!1,this.lose2.active=!1,this.lose1.active=!0):(this.win2.active=!1,this.win1.active=!0,this.lose2.active=!0,this.lose1.active=!1),this.scheduleOnce(function(){e()},6)},__decorate([r(cc.Node)],e.prototype,"topContainer",void 0),__decorate([r(cc.Node)],e.prototype,"bottomContainer",void 0),__decorate([r(cc.Node)],e.prototype,"win1",void 0),__decorate([r(cc.Node)],e.prototype,"win2",void 0),__decorate([r(cc.Node)],e.prototype,"lose1",void 0),__decorate([r(cc.Node)],e.prototype,"lose2",void 0),e=__decorate([i],e)}(cc.Component);o.OverAnim=a,cc._RF.pop()},{}],PlayerCollider:[function(t,e,o){"use strict";cc._RF.push(e,"c1784pBRf5A6LNKUeW1GFGA","PlayerCollider"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./block/BaseBlock"),i=t("./Player"),r=cc._decorator,a=r.ccclass,c=(r.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onCollisionEnter=function(t,e){233===t.tag&&(t.node.parent.getComponent(n.BaseBlock).showBlood(),this.node.parent.getComponent(i.Player).die())},e=__decorate([a],e)}(cc.Component));o.PlayerCollider=c,cc._RF.pop()},{"./Player":"Player","./block/BaseBlock":"BaseBlock"}],Player:[function(t,e,o){"use strict";cc._RF.push(e,"9edf9HxFRJGHpWm6nmfN4y0","Player"),Object.defineProperty(o,"__esModule",{value:!0});var n,i=t("../../libs/NextFSM"),r=cc._decorator,a=r.ccclass,c=r.property;(function(t){t[t.NONE=0]="NONE",t[t.RUN=1]="RUN",t[t.JUMP=2]="JUMP",t[t.DASH=3]="DASH",t[t.DROP=4]="DROP",t[t.DIE=5]="DIE"})(n||(n={}));var s=function(t){function e(){var e,o=null!==t&&t.apply(this,arguments)||this;return o.dir=1,o.speedX=100,o.jumpSpeed=200,o.gravity=10,o.camera=null,o.width=1e4,o.dashLength=200,o.animation=null,o.streakNode=null,o.progressLabel=null,o.speedY=0,o.dashOrigin=cc.Vec2.ZERO,o.totalDistance=0,o.isReturn=!1,o.mainScene=null,o.fsm=new i.NextFSM(((e={})[n.NONE]={to:[n.RUN]},e[n.RUN]={to:[n.JUMP,n.DIE,n.NONE],enter:o.onEnterRun},e[n.JUMP]={to:[n.DASH,n.RUN,n.DIE,n.NONE],enter:o.onEnterJump},e[n.DASH]={to:[n.DROP,n.DIE,n.NONE],enter:o.onEnterDash,exit:o.onExitDash},e[n.DROP]={to:[n.NONE,n.RUN,n.DIE,n.NONE],enter:o.onEnterDrop},e[n.DIE]={to:[n.RUN,n.NONE],enter:o.onEnterDie,exit:o.onExitDie},e),n.NONE,o),o}return __extends(e,t),e.prototype.init=function(t,e){this.mainScene=t,this.totalDistance=e},e.prototype.stop=function(){this.fsm.setState(n.NONE)},e.prototype.run=function(){this.fsm.setState(n.RUN)},e.prototype.die=function(){this.fsm.setState(n.DIE)},e.prototype.jump=function(){this.fsm.canTo(n.JUMP)?this.fsm.setState(n.JUMP):this.fsm.canTo(n.DASH)&&this.fsm.setState(n.DASH)},e.prototype.return=function(){this.mainScene.playSecondBgm(),this.isReturn=!0,this.node.scaleX*=-1,this.camera.node.x-=840*this.dir,this.dir*=-1},e.prototype.forward=function(){this.isReturn=!1,this.node.scale*=-1,this.camera.node.x-=840*this.dir,this.dir*=-1},e.prototype.relive=function(){if(console.log("restart"),this.isReturn&&this.forward(),1===this.dir){var t=0-this.node.x;this.camera.node.x+=t,this.node.x+=t}else{t=0-this.node.x;this.camera.node.x+=t,this.node.x+=t}this.fsm.setState(n.RUN)},e.prototype.showStreak=function(){this.streakNode.active=!0},e.prototype.hideStreak=function(){this.streakNode.active=!1},e.prototype.onEnterRun=function(){this.animation.play(),this.node.y=0,this.speedY=0},e.prototype.onEnterJump=function(){this.speedY=this.jumpSpeed},e.prototype.onEnterDash=function(){this.speedX*=5,this.dashOrigin=this.node.position,this.node.angle=-90*this.dir,this.showStreak()},e.prototype.onExitDash=function(){this.speedX/=5,this.hideStreak(),this.node.angle=0},e.prototype.onEnterDrop=function(){this.speedY=0},e.prototype.onEnterDie=function(){this.node.x+=100*this.dir,this.animation.play("die")},e.prototype.onExitDie=function(){this.node.x-=100*this.dir},e.prototype.updateProgress=function(){var t=Math.round((Math.abs(this.node.x)+420)/this.totalDistance*100);this.progressLabel.string=t+"%",t>=100&&this.mainScene.overGame(1===this.dir)},e.prototype.update=function(t){var e=this.fsm.getState();if(e!==n.NONE&&e!==n.DIE){e===n.JUMP||e===n.DROP?(this.speedY-=this.gravity*t,this.node.y+=this.speedY*t,this.node.y<=0&&this.fsm.setState(n.RUN)):e===n.DASH&&(this.node.x-this.dashOrigin.x)*this.dir>=this.dashLength&&this.fsm.setState(n.DROP);var o=this.speedX*t*this.dir;this.node.x+=o,this.camera.node.x+=o,this.updateProgress()}},__decorate([c(cc.Integer)],e.prototype,"dir",void 0),__decorate([c(cc.Integer)],e.prototype,"speedX",void 0),__decorate([c(cc.Integer)],e.prototype,"jumpSpeed",void 0),__decorate([c(cc.Integer)],e.prototype,"gravity",void 0),__decorate([c(cc.Camera)],e.prototype,"camera",void 0),__decorate([c(cc.Integer)],e.prototype,"width",void 0),__decorate([c(cc.Integer)],e.prototype,"dashLength",void 0),__decorate([c(cc.Animation)],e.prototype,"animation",void 0),__decorate([c(cc.Node)],e.prototype,"streakNode",void 0),__decorate([c(cc.Label)],e.prototype,"progressLabel",void 0),e=__decorate([a],e)}(cc.Component);o.Player=s,cc._RF.pop()},{"../../libs/NextFSM":"NextFSM"}],RoadManager:[function(t,e,o){"use strict";cc._RF.push(e,"6bb48AybXdBL5OgjcC6R9OI","RoadManager"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./block/BaseBlock"),i=t("../../utils/MathHelper"),r=t("./Wave"),a=cc._decorator,c=a.ccclass,s=a.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.width=1e4,e.bg=null,e.blockPrefabs=[],e.minSpace=2e3,e.maxSpace=3e3,e.wavePrefab=null,e.mainScene=null,e.nextBlockX=0,e}return __extends(e,t),e.prototype.init=function(t){this.mainScene=t,this.bg.width=this.width,this.initBlocks(),this.initWavePool(),this.mainScene.onRoadInit(-this.width/2,this.width/2)},e.prototype.getHalfDistance=function(){return this.width/2},e.prototype.initBlocks=function(){this.nextBlockX=1e3;for(var t=this.width/2-1e3;this.nextBlockX<t;)this.addBlock()},e.prototype.initWavePool=function(){this.wavePool=new cc.NodePool;for(var t=0;t<8;t++)this.wavePool.put(cc.instantiate(this.wavePrefab))},e.prototype.createWaveNode=function(t){var e=null;return(e=this.wavePool.size()>0?this.wavePool.get():cc.instantiate(this.wavePrefab)).position=cc.v2(0,0),e.scaleX=t,e},e.prototype.onWaveNodeRecycle=function(t){this.wavePool.put(t)},e.prototype.shot=function(t,e){for(var o=0;o<5;o++){var n=this.createWaveNode(e);this.node.addChild(n),n.position=this.node.convertToNodeSpaceAR(t),n.getComponent(r.Wave).shot(e,this.onWaveNodeRecycle.bind(this))}},e.prototype.addBlock=function(){var t=Math.random()*this.blockPrefabs.length|0,e=cc.instantiate(this.blockPrefabs[t]);e.position=cc.v2(this.nextBlockX,0),this.bg.addChild(e),e.getComponent(n.BaseBlock).init();var o=cc.instantiate(this.blockPrefabs[t]);o.position=cc.v2(-this.nextBlockX,0),this.bg.addChild(o),o.getComponent(n.BaseBlock).init(),this.nextBlockX+=e.getComponent(n.BaseBlock).width+this.getRandomSpace()},e.prototype.getRandomSpace=function(){return i.MathHelper.GetRandomIntegerInRange(this.minSpace,this.maxSpace)},__decorate([s(cc.Integer)],e.prototype,"width",void 0),__decorate([s(cc.Node)],e.prototype,"bg",void 0),__decorate([s([cc.Prefab])],e.prototype,"blockPrefabs",void 0),__decorate([s(cc.Integer)],e.prototype,"minSpace",void 0),__decorate([s(cc.Integer)],e.prototype,"maxSpace",void 0),__decorate([s(cc.Prefab)],e.prototype,"wavePrefab",void 0),e=__decorate([c],e)}(cc.Component);o.RoadManager=p,cc._RF.pop()},{"../../utils/MathHelper":"MathHelper","./Wave":"Wave","./block/BaseBlock":"BaseBlock"}],StartAnim:[function(t,e,o){"use strict";cc._RF.push(e,"631e8LvBaxPx5lSbW5HNqBM","StartAnim"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,i=n.ccclass,r=n.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.frame1=null,e.frame2=null,e.frame3=null,e.frame4=null,e}return __extends(e,t),e.prototype.play=function(t){var e=this;this.node.active=!0,this.scheduleOnce(function(){e.frame2.active=!0,e.scheduleOnce(function(){e.frame3.active=!0,e.schedule(function(){e.frame3.active=!e.frame3.active},.2)},1),e.scheduleOnce(function(){e.frame1.active=!1,e.frame2.active=!1,e.frame3.active=!1,e.frame4.active=!0},4)},1),this.scheduleOnce(function(){e.node.active=!1,t()},10)},__decorate([r(cc.Node)],e.prototype,"frame1",void 0),__decorate([r(cc.Node)],e.prototype,"frame2",void 0),__decorate([r(cc.Node)],e.prototype,"frame3",void 0),__decorate([r(cc.Node)],e.prototype,"frame4",void 0),e=__decorate([i],e)}(cc.Component);o.StartAnim=a,cc._RF.pop()},{}],Wave:[function(t,e,o){"use strict";cc._RF.push(e,"bcaf9DeEPROCL1O6olMBYJK","Wave"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,i=n.ccclass,r=n.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.speed=800,e.totalDistance=1500,e.dir=0,e.startX=0,e}return __extends(e,t),e.prototype.shot=function(t,e){this.dir=t,this.finishCb=e,this.startX=this.node.x},e.prototype.onCollisionEnter=function(t,e){233===t.tag&&this.finishCb(this.node)},e.prototype.update=function(t){0!==this.dir&&(this.node.x+=this.speed*t*this.dir,this.node.x-this.startX>=this.totalDistance&&this.finishCb(this.node))},__decorate([r(cc.Integer)],e.prototype,"speed",void 0),__decorate([r(cc.Integer)],e.prototype,"totalDistance",void 0),e=__decorate([i],e)}(cc.Component);o.Wave=a,cc._RF.pop()},{}]},{},["G","NextFSM","LoadingScene","MainScene","OverAnim","Player","PlayerCollider","RoadManager","StartAnim","Wave","BaseBlock","Block1","MathHelper"]);